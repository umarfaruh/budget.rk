<html lang="ru">
<head>
  <title> finance </title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />


 
  <body>
  <!-- üîπ –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="navbar">
    <a href="http://127.0.0.1:5500/index.html">–î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã</a>
    <a href="https://umarfaruh.github.io/financial_management/">–ù–∞–ª–æ–≥–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</a>
    <a href="http://127.0.0.1:5502/index.html">–ù–∞–∫–æ–ø–∏ –Ω–∞ –º–µ—á—Ç—É</a>
    <a href="https://umarfaruh.github.io/mortgage/">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏–ø–æ—Ç–µ–∫–∏</a>
  </div>

  <style>
    /* üî∏ –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø–∞–Ω–µ–ª–∏ */
    .navbar {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      background-color: #1e3a8a;
      padding: 14px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin: 20px;
    }

    /* üî∏ –ö–Ω–æ–ø–∫–∏ */
    .navbar a {
      background-color: #2563eb;
      color: white;
      text-decoration: none;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    /* üî∏ –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    .navbar a:hover {
      background-color: #1d4ed8;
      transform: translateY(-2px);
    }

    /* üî∏ –î–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∞–¥–∞–ø—Ç–∏–≤) */
    @media (max-width: 600px) {
      .navbar {
        flex-direction: column;
        align-items: stretch;
      }
      .navbar a {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</body>



  
  <title>–ë—é–¥–∂–µ—Ç ‚Äî –£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</title>

  
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--muted:#6b7280;--accent:#2563eb;--green:#10b981;--red:#ef4444}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:var(--bg);color:#0f172a;padding:20px}
    .container{max-width:1000px;margin:0 auto}
    header{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .brand{display:flex;flex-direction:column}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input,select,button,textarea{width:100%;padding:8px 10px;border-radius:8px;border:1px solid #e6edf6;background:transparent}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .muted{color:var(--muted);font-size:13px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;text-align:left;border-bottom:1px solid #f1f5f9;font-size:14px}
    .amount{font-weight:600}
    .amount.income{color:var(--green)}
    .amount.expense{color:var(--red)}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{display:inline-block;padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer}
    .btn.secondary{background:#eef2ff;color:var(--accent);border:1px solid #dbeafe}
    .small{font-size:13px;padding:6px 8px}
    .center{text-align:center}
    @media(max-width:920px){.grid{grid-template-columns:1fr;}.card{padding:12px}}
    .totals{display:flex;gap:10px;align-items:center;margin-bottom:10px}
    .totals .box{flex:1;padding:10px;border-radius:8px;background:#f8fafc}
    .chart{height:150px;width:100%;display:block}
    .empty{padding:40px;text-align:center;color:var(--muted)}
  </style>
  
</style>

</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <h1>–ë—é–¥–∂–µ—Ç ‚Äî —É—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h1>
        <p class="lead">–ü—Ä–æ—Å—Ç–æ–π SPA –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤: –¥–æ–±–∞–≤–ª—è–π –¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã –∏ —Å–ª–µ–¥–∏ –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
      </div>
    </header>

    <div class="grid">
      <!-- main -->
      <div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <div>
              <strong>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</strong>
              <div class="muted">–°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)</div>
            </div>
            <div class="controls">
              <select id="filterMonth" class="small">
                <!-- populated by JS -->
              </select>
              <button class="btn secondary small" id="btnClear">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
          </div>

          <div id="transactionsContainer"></div>
        </div>

        <div class="card" style="margin-top:16px">
          <strong>–≠–∫—Å–ø–æ—Ä—Ç / –∏–º–ø–æ—Ä—Ç</strong>
          <p class="muted">–°–æ—Ö—Ä–∞–Ω–∏ –¥–∞–Ω–Ω—ã–µ –≤ CSV –∏–ª–∏ JSON ‚Äî —É–¥–æ–±–Ω–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.</p>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" id="exportCsv">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
            <button class="btn" id="exportJson">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
            <label class="btn secondary small" style="cursor:pointer;display:inline-flex;align-items:center;">–ò–º–ø–æ—Ä—Ç
              <input id="importFile" type="file" accept="application/json,.json" style="display:none">
            </label>
          </div>
        </div>
      </div>



      <!-- sidebar -->
      <aside>
        <div class="card">
          <strong>–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</strong>
          <form id="entryForm" style="margin-top:10px">
            <label>–¢–∏–ø</label>
            <select id="type">
              <option value="income">–î–æ—Ö–æ–¥</option>
              <option value="expense">–†–∞—Å—Ö–æ–¥</option>
            </select>

            <label>–°—É–º–º–∞ (KZT)</label>
            <input id="amount" type="number" step="0.01" required />

            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="category">
              <option>–ü—Ä–æ—á–µ–µ</option>
              <option>–ï–¥–∞</option>
              <option>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
              <option>–£—á—ë–±–∞</option>
              <option>–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
              <option>–ó–∞—Ä–ø–ª–∞—Ç–∞</option>
              <option>–§—Ä–∏–ª–∞–Ω—Å</option>
            </select>

            <label>–î–∞—Ç–∞</label>
            <input id="date" type="date" required />

            <label>–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
            <input id="note" type="text" />

            <div style="display:flex;gap:8px;margin-top:10px">
              <button class="btn" type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
              <button class="btn secondary" type="button" id="btnUndo">–û—Ç–º–µ–Ω–∏—Ç—å</button>
            </div>
          </form>
        </div>



        <div class="card" style="margin-top:16px">
          <strong>–ò—Ç–æ–≥–∏</strong>
          <div class="totals" style="margin-top:10px">
            <div class="box">
              <div class="muted">–î–æ—Ö–æ–¥—ã</div>
              <div id="sumIncome" style="font-weight:700">0 KZT</div>
            </div>
            <div class="box">
              <div class="muted">–†–∞—Å—Ö–æ–¥—ã</div>
              <div id="sumExpense" style="font-weight:700">0 KZT</div>
            </div>
            <div class="box">
              <div class="muted">–ë–∞–ª–∞–Ω—Å</div>
              <div id="balance" style="font-weight:700">0 KZT</div>
            </div>
          </div>

          <canvas id="chart" class="chart"></canvas>
          <div class="muted" style="font-size:12px;margin-top:8px">–ì—Ä–∞—Ñ–∏–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü</div>
        </div>

      </aside>
    </div>
  </div>

<script>
// Simple budget app: stores entries in localStorage
const STORAGE_KEY = 'student_budget_entries_v1'
let entries = []

// Elements
const form = document.getElementById('entryForm')
const typeEl = document.getElementById('type')
const amountEl = document.getElementById('amount')
const categoryEl = document.getElementById('category')
const dateEl = document.getElementById('date')
const noteEl = document.getElementById('note')
const transactionsContainer = document.getElementById('transactionsContainer')
const sumIncomeEl = document.getElementById('sumIncome')
const sumExpenseEl = document.getElementById('sumExpense')
const balanceEl = document.getElementById('balance')
const filterMonth = document.getElementById('filterMonth')
const btnClear = document.getElementById('btnClear')
const btnExportCsv = document.getElementById('exportCsv')
const btnExportJson = document.getElementById('exportJson')
const importFile = document.getElementById('importFile')
const chartCanvas = document.getElementById('chart')
const btnUndo = document.getElementById('btnUndo')

let lastAddedId = null

// On load
init()

function init(){
  // set default date to today
  const today = new Date().toISOString().slice(0,10)
  dateEl.value = today

  load()
  populateMonthFilter()
  render()

  form.addEventListener('submit', onAdd)
  btnClear.addEventListener('click', onClear)
  btnExportCsv.addEventListener('click', exportCsv)
  btnExportJson.addEventListener('click', exportJson)
  importFile.addEventListener('change', onImport)
  filterMonth.addEventListener('change', render)
  btnUndo.addEventListener('click', undoLast)
}

function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(entries))
}

function load(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY)
    entries = raw ? JSON.parse(raw) : []
  }catch(e){ entries = [] }
}

function populateMonthFilter(){
  // build list of months present in data
  const months = new Set()
  entries.forEach(e => months.add(e.date.slice(0,7)))
  // always add current month
  months.add(new Date().toISOString().slice(0,7))
  const arr = Array.from(months).sort((a,b)=>b.localeCompare(a))
  filterMonth.innerHTML = ''
  arr.forEach(m => {
    const opt = document.createElement('option')
    opt.value = m
    opt.textContent = formatMonthLabel(m)
    filterMonth.appendChild(opt)
  })
}

function formatMonthLabel(ym){
  const [y,mo] = ym.split('-')
  return `${mo}.${y}`
}

function onAdd(e){
  e.preventDefault()
  const amount = parseFloat(amountEl.value)
  if(!amount || amount <= 0) return alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É > 0')
  const entry = {
    id: Date.now().toString(),
    type: typeEl.value,
    amount: Math.round(amount*100)/100,
    category: categoryEl.value,
    date: dateEl.value,
    note: noteEl.value || ''
  }
  entries.unshift(entry)
  lastAddedId = entry.id
  save()
  populateMonthFilter()
  render()
  form.reset()
  dateEl.value = new Date().toISOString().slice(0,10)
}

function onClear(){
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å.')) return
  entries = []
  save()
  populateMonthFilter()
  render()
}

function render(){
  const month = filterMonth.value || new Date().toISOString().slice(0,7)
  // list transactions for selected month
  const filtered = entries.filter(e => e.date.slice(0,7) === month)
  transactionsContainer.innerHTML = ''
  if(filtered.length === 0){
    transactionsContainer.innerHTML = '<div class="empty">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü</div>'
  }else{
    const table = document.createElement('table')
    table.innerHTML = `<thead><tr><th>–î–∞—Ç–∞</th><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–°—É–º–º–∞</th><th></th></tr></thead>`
    const tbody = document.createElement('tbody')
    filtered.forEach(e => {
      const tr = document.createElement('tr')
      tr.innerHTML = `<td>${e.date}</td><td>${escapeHtml(e.category)}</td><td>${escapeHtml(e.note)}</td><td class="amount ${e.type}">${e.type==='income'?'+':''}-${formatAmount(e.amount)} KZT</td><td style="text-align:right"><button data-id="${e.id}" class="small btn secondary">–£–¥–∞–ª–∏—Ç—å</button></td>`
      tbody.appendChild(tr)
    })
    table.appendChild(tbody)
    transactionsContainer.appendChild(table)
    // attach delete handlers
    transactionsContainer.querySelectorAll('button[data-id]').forEach(b=>b.addEventListener('click', onDelete))
  }

  // totals for selected month
  const income = filtered.filter(e=>e.type==='income').reduce((s,e)=>s+e.amount,0)
  const expense = filtered.filter(e=>e.type==='expense').reduce((s,e)=>s+e.amount,0)
  sumIncomeEl.textContent = formatAmount(income) + ' KZT'
  sumExpenseEl.textContent = formatAmount(expense) + ' KZT'
  balanceEl.textContent = formatAmount(income - expense) + ' KZT'

  drawChart(filtered)
}

function onDelete(ev){
  const id = ev.currentTarget.dataset.id
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é?')) return
  entries = entries.filter(e=>e.id !== id)
  save()
  render()
}

function exportCsv(){
  if(entries.length===0) return alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞')
  const rows = [['id','type','amount','category','date','note']]
  entries.forEach(e => rows.push([e.id,e.type,e.amount,e.category,e.date,`"${(e.note||'').replace(/"/g,'""')}"`]))
  const csv = rows.map(r=>r.join(',')).join('\n')
  downloadFile(csv, 'budget_export.csv', 'text/csv')
}

function exportJson(){
  if(entries.length===0) return alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞')
  const json = JSON.stringify(entries, null, 2)
  downloadFile(json, 'budget_export.json', 'application/json')
}


function onImport(e){
  const f = e.target.files[0]
  if(!f) return
  const reader = new FileReader()
  reader.onload = ()=>{
    try{
      const parsed = JSON.parse(reader.result)
      if(!Array.isArray(parsed)) throw new Error('–û–∂–∏–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ –∑–∞–ø–∏—Å–µ–π')
      // simple merge, keep unique ids
      const existingIds = new Set(entries.map(x=>x.id))
      const toAdd = parsed.filter(x=>!existingIds.has(x.id))
      entries = toAdd.concat(entries)
      save()
      populateMonthFilter()
      render()
      alert('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ' + toAdd.length + ' –∑–∞–ø–∏—Å–µ–π')
    }catch(err){ alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + err.message) }
  }
  reader.readAsText(f)
  importFile.value = null
}

function downloadFile(content, filename, mime){
  const blob = new Blob([content], {type: mime})
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove()
  URL.revokeObjectURL(url)
}

function undoLast(){
  if(!lastAddedId) return alert('–ù–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–º–µ–Ω—ã')
  entries = entries.filter(e=>e.id !== lastAddedId)
  lastAddedId = null
  save(); render()
}

function formatAmount(n){
  return Number(n).toLocaleString('ru-RU', {minimumFractionDigits: 0, maximumFractionDigits: 2})
}

function escapeHtml(s){
  if(!s) return ''
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
}

// Simple category chart: draws bars on canvas
function drawChart(data){
  const byCat = {}
  data.forEach(d => {
    if(!byCat[d.category]) byCat[d.category] = 0
    byCat[d.category] += (d.type==='income'?d.amount:-d.amount)
  })
  const cats = Object.keys(byCat)
  const values = cats.map(c=>Math.abs(byCat[c]))
  const ctx = chartCanvas.getContext('2d')
  const W = chartCanvas.width = chartCanvas.clientWidth * devicePixelRatio
  const H = chartCanvas.height = chartCanvas.clientHeight * devicePixelRatio
  ctx.clearRect(0,0,W,H)
  if(cats.length === 0){
    ctx.fillStyle = '#94a3b8'; ctx.font = `${12*devicePixelRatio}px sans-serif`; ctx.textAlign='center'
    ctx.fillText('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞', W/2, H/2)
    return
  }
  const max = Math.max(...values)
  const padding = 24*devicePixelRatio
  const barW = (W - padding*2) / cats.length * 0.6
  const gap = (W - padding*2) / cats.length
  cats.forEach((c,i)=>{
    const val = values[i]
    const h = max===0?0: (val/max) * (H - padding*2)
    const x = padding + i*gap + (gap-barW)/2
    const y = H - padding - h
    // color by sign
    const positive = Object.values(byCat)[i] >= 0
    ctx.fillStyle = positive ? '#10b981' : '#ef4444'
    ctx.fillRect(x, y, barW, h)
    // label
    ctx.fillStyle = '#0f172a'
    ctx.font = `${10*devicePixelRatio}px sans-serif`
    ctx.textAlign = 'center'
    ctx.fillText(c, x + barW/2, H - 6*devicePixelRatio)
  })
}

// initialize filter select to current month if empty
if(!filterMonth.value){
  filterMonth.value = new Date().toISOString().slice(0,7)
}

</script>

</body>
</html>
